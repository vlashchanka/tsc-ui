<!DOCTYPE html>
<html lang="en">

<head>
    <link rel="icon" href="https://www.typescriptlang.org/favicon.ico" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TS UI</title>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css">
    <link href="https://unpkg.com/tailwindcss/dist/tailwind.min.css" rel="stylesheet"> <!--Replace with your tailwind.css once created-->
</head>


<body class="bg-gray-800 font-sans leading-normal tracking-normal mt-12">

<!--Nav-->
<nav class="bg-gray-800 pt-2 md:pt-1 pb-1 px-1 mt-0 h-auto fixed w-full z-20 top-0">

    <div class="flex flex-wrap items-center">
        <div class="flex flex-shrink md:w-1/3 justify-center md:justify-start text-white">
            <a class="pl-2" href="#">
                <svg fill="none" height="26" viewBox="0 0 27 26" width="27" xmlns="http://www.w3.org/2000/svg"><path clip-rule="evenodd" d="m.98608 0h24.32332c.5446 0 .9861.436522.9861.975v24.05c0 .5385-.4415.975-.9861.975h-24.32332c-.544597 0-.98608-.4365-.98608-.975v-24.05c0-.538478.441483-.975.98608-.975zm13.63142 13.8324v-2.1324h-9.35841v2.1324h3.34111v9.4946h2.6598v-9.4946zm1.0604 9.2439c.4289.2162.9362.3784 1.5218.4865.5857.1081 1.2029.1622 1.8518.1622.6324 0 1.2331-.0595 1.8023-.1784.5691-.1189 1.0681-.3149 1.497-.5879s.7685-.6297 1.0187-1.0703.3753-.9852.3753-1.6339c0-.4703-.0715-.8824-.2145-1.2365-.1429-.3541-.3491-.669-.6186-.9447-.2694-.2757-.5925-.523-.9692-.7419s-.8014-.4257-1.2743-.6203c-.3465-.1406-.6572-.2771-.9321-.4095-.275-.1324-.5087-.2676-.7011-.4054-.1925-.1379-.3409-.2838-.4454-.4379-.1045-.154-.1567-.3284-.1567-.523 0-.1784.0467-.3392.1402-.4824.0935-.1433.2254-.2663.3959-.369s.3794-.1824.6269-.2392c.2474-.0567.5224-.0851.8248-.0851.22 0 .4523.0162.697.0486.2447.0325.4908.0825.7382.15.2475.0676.4881.1527.7218.2555.2337.1027.4495.2216.6475.3567v-2.4244c-.4015-.1514-.84-.2636-1.3157-.3365-.4756-.073-1.0214-.1095-1.6373-.1095-.6268 0-1.2207.0662-1.7816.1987-.5609.1324-1.0544.3392-1.4806.6203s-.763.6392-1.0104 1.0743c-.2475.4352-.3712.9555-.3712 1.5609 0 .7731.2268 1.4326.6805 1.9785.4537.546 1.1424 1.0082 2.0662 1.3866.363.146.7011.2892 1.0146.4298.3134.1405.5842.2865.8124.4378.2282.1514.4083.3162.5403.4946s.198.3811.198.6082c0 .1676-.0413.323-.1238.4662-.0825.1433-.2076.2676-.3753.373s-.3766.1879-.6268.2473c-.2502.0595-.5431.0892-.8785.0892-.5719 0-1.1383-.0986-1.6992-.2959-.5608-.1973-1.0805-.4933-1.5589-.8879z" fill="#fff" fill-rule="evenodd"></path></svg>
            </a>
        </div>

        <div class="flex w-full pt-2 content-center justify-between md:w-2/3 md:justify-end">
            <ul class="list-reset flex justify-between flex-1 md:flex-none items-center">
                <li class="flex-1 md:flex-none md:mr-3"></li>
                <li class="flex-1 md:flex-none md:mr-3"></li>
                <li class="flex-1 md:flex-none md:mr-3">
                    <div class="relative inline-block">
                        <span class="drop-button text-white focus:outline-none">Hi, {{user}}!</span>
                    </div>
                </li>
            </ul>
        </div>
    </div>

</nav>


<div class="flex flex-col md:flex-row">

    <div class="bg-gray-800 shadow-xl h-16 fixed bottom-0 mt-12 md:relative md:h-screen z-10 w-full md:w-48">

        <div class="md:mt-12 md:w-48 md:fixed md:left-0 md:top-0 content-center md:content-start text-left justify-between">
            <ul class="list-reset flex flex-row md:flex-col py-0 md:py-3 px-1 md:px-2 text-center md:text-left">
                <li class="mr-3 flex-1">
                    <a data-nav-sidebar href="#diagnostics" class="block py-1 md:py-3 pl-1 align-middle text-green-600 no-underline border-b-2 border-gray-800 hover:border-green-500">
                        <i class="fa fa-envelope pr-0 md:pr-3"></i><span class="pb-1 md:pb-0 text-xs md:text-base text-gray-600 block md:inline-block">Diagnostics</span>
                    </a>
                </li>
                <li class="mr-3 flex-1">
                    <a data-nav-sidebar href="#" class="block py-1 md:py-3 pl-1 align-middle text-white no-underline hover:text-white border-b-2 border-gray-800 hover:border-blue-500">
                        <i class="fas fa-chart-area pr-0 md:pr-3 text-blue-600"></i><span class="pb-1 md:pb-0 text-xs md:text-base text-gray-600 block md:inline-block">Status</span>
                    </a>
                </li>
            </ul>
        </div>


    </div>

    <div data-nav="#diagnostics" class="main-content flex-1 bg-gray-100 mt-12 md:mt-2 pb-24 md:pb-5">
        <div class="bg-gray-800 pt-3">
            <div class="rounded-tl-3xl bg-gradient-to-r from-green-500 to-gray-800 p-4 shadow text-2xl text-white">
                <h3 class="font-bold pl-2">Diagnostics</h3>
            </div>
        </div>
        <!-- This example requires Tailwind CSS v2.0+ -->
        <div class="flex flex-col">
            <div class="-my-2 overflow-x-auto sm:-mx-6 lg:-mx-8">
                <div class="py-2 align-middle inline-block min-w-full sm:px-6 lg:px-8">
                    <div class="shadow overflow-hidden border-b border-gray-200 sm:rounded-lg">
                        <table class="min-w-full divide-y divide-gray-200 table-auto">
                            <thead class="bg-gray-50">
                            <tr>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    File Name / Error
                                </th>
                                <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                    Code
                                </th>
                            </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200" id="diagnostics-table"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div data-nav="" class="main-content flex-1 bg-gray-100 mt-12 md:mt-2 pb-24 md:pb-5">

        <div class="bg-gray-800 pt-3">
            <div class="rounded-tl-3xl bg-gradient-to-r from-blue-500 to-gray-800 p-4 shadow text-2xl text-white">
                <h3 class="font-bold pl-2">{{project}}</h3>
            </div>
        </div>

        <div class="flex flex-wrap">
            <div class="w-full md:w-1/2 xl:w-1/3 p-6">
                <!--Metric Card-->
                <div class="bg-gradient-to-b from-blue-200 to-blue-100 border-b-4 border-blue-500 rounded-lg shadow-xl p-5">
                    <div class="flex flex-row items-center">
                        <div class="flex-shrink pr-4">
                            <div class="rounded-full p-5 bg-blue-600"><i class="fas fa-server fa-2x fa-inverse"></i></div>
                        </div>
                        <div class="flex-1 text-right md:text-center">
                            <h5 class="font-bold uppercase text-gray-600">Files affected</h5>
                            <h3 class="font-bold text-3xl"><span id="filesAffected">0</span> file(s)</h3>
                        </div>
                    </div>
                </div>
                <!--/Metric Card-->
            </div>
            <div class="w-full md:w-1/2 xl:w-1/3 p-6">
                <!--Metric Card-->
                <div class="bg-gradient-to-b from-indigo-200 to-indigo-100 border-b-4 border-indigo-500 rounded-lg shadow-xl p-5">
                    <div class="flex flex-row items-center">
                        <div class="flex-shrink pr-4">
                            <div class="rounded-full p-5 bg-indigo-600"><i class="fas fa-tasks fa-2x fa-inverse"></i></div>
                        </div>
                        <div class="flex-1 text-right md:text-center">
                            <h5 class="font-bold uppercase text-gray-600">Diagnostics</h5>
                            <h3 class="font-bold text-3xl"><span id="diagnostics">0</span> problem(s)</h3>
                        </div>
                    </div>
                </div>
                <!--/Metric Card-->
            </div>
            <div class="w-full md:w-1/2 xl:w-1/3 p-6">
                <!--Metric Card-->
                <div class="bg-gradient-to-b from-red-200 to-red-100 border-b-4 border-red-500 rounded-lg shadow-xl p-5">
                    <div class="flex flex-row items-center">
                        <div class="flex-shrink pr-4">
                            <div class="rounded-full p-5 bg-red-600"><i class="fas fa-exclamation-triangle fa-2x fa-inverse"></i></div>
                        </div>
                        <div class="flex-1 text-right md:text-center">
                            <h5 class="font-bold uppercase text-gray-600">Unique error codes</h5>
                            <h3 class="font-bold text-3xl" id="errorCodes">0</h3>
                        </div>
                    </div>
                </div>
                <!--/Metric Card-->
            </div>
        </div>
    </div>
</div>

<style>
    .tt {
        white-space: break-spaces;
    }
</style>

<script>
    window.setInterval(getProjectStatus, 500);
    getProjectStatus();


    const diagnosticsTemplate = `
    <tr>
        <td class="px-6 py-4 whitespace-nowrap">
            <div class="text-sm text-green-900">
            <!--<a target="_blank" href="http://localhost:63342/api/file/{{fileName}}">{{fileName}}</a>-->
                <a href="vscode://file/{{fileName}}">{{fileName}}</a>
            </div>
            <div class="text-sm text-pink-700 max-w-full tt">{{error}}</div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
              <a target="_blank" href="https://www.google.com/search?q=typescript+error+code+TS{{code}}">{{code}}</a>
            </span>
        </td>
    </tr>`;

    function interpolateVars(html = '', vars = []) {
        return vars.reduce((template, [find, replace]) => {
            return template.replace(new RegExp(`{{${find}}}`, 'g'), replace);
        }, html);
    }

    function getProjectStatus() {
        fetch("/messages").then(res => res.json()).then((res) => {
            // Dashboard
            Object.keys(res).map(key => {
                document.getElementById(key).innerText = res[key].length;
            });

            document.getElementById('diagnostics-table').innerHTML = res.diagnostics.map(d => {
              return interpolateVars(diagnosticsTemplate, [
                  ['fileName', d.fileName],
                  ['error', d.error],
                  ['code', d.code],
              ])
            }).join("");
        })
    }


    window.addEventListener('popstate', checkLocation);
    checkLocation();


    function checkLocation() {
        document.querySelectorAll("[data-nav]").forEach(el => {
            if (location.hash === el.getAttribute("data-nav")) {
                el.classList.remove("hidden");
            } else {
                el.classList.add("hidden");
            }
        });
        document.querySelectorAll("[data-nav-sidebar]").forEach(el => {
            const isHome = (el.getAttribute("href") === "#" && location.hash === "");
            if (location.hash === el.getAttribute("href") || isHome) {
                const text = el.querySelector('span');
                text.classList.add("text-white");
                text.classList.remove("text-gray-600");
            } else {
                const text = el.querySelector('span');
                text.classList.add("text-gray-600");
                text.classList.remove("text-white");
            }
        })
    }
</script>
</body>
</html>
